<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Data - Data Analytics</title>
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        main {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
        }
        .sidebar {
            height: 100%;
            width: 280px;
            flex-shrink: 0;
            overflow-y: auto;
        }
        .content-wrapper {
            flex: 1;
            height: 100%;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1.5rem;
        }
        .table-card {
            transition: transform 0.2s;
            cursor: pointer;
        }
        .table-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .card-icon {
            font-size: 2rem;
            color: #63f1bf;
            margin-bottom: 1rem;
        }
        .table-preview {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .modal-dialog {
            max-width: 90%;
        }
        .search-box {
            max-width: 400px;
            margin: 0 auto 2rem auto;
        }
        .table-stats {
            font-size: 0.85rem;
            color: #6c757d;
        }
        .table-container {
            overflow-x: auto;
        }
        .data-card {
            height: 100%;
        }
    </style>
</head>
<body>

<main class="d-flex">
    <!-- Sidebar -->
    <div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 280px;">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
            <!-- <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg> -->
            <!-- <i class="bi bi-globe-asia-australia" width="40" height="32"></i> -->
            <span class="fs-4"> GreenAnalytica</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a href="index.html" class="nav-link link-dark">
                    <i class="bi bi-house-door me-2"></i>
                    Home
                </a>
            </li>
            <li>
                <a href="browse-data.html" class="nav-link active" aria-current="page">
                    <i class="bi bi-search me-2"></i>
                    Browse Data
                </a>
            </li>
            <li>
                <a href="#" class="nav-link link-dark">
                    <i class="bi bi-plus-circle me-2"></i>
                    Add Data Source
                </a>
            </li>
            
            <li class="mt-4 mb-2">
                <small class="text-muted px-3 fw-bold">COLLECTIONS</small>
            </li>
            <li>
                <a href="#" class="nav-link link-dark">
                    <i class="bi bi-graph-up me-2"></i>
                    Our Analytics
                </a>
            </li>
            <li>
                <a href="personal-collection.html" class="nav-link link-dark">
                    <i class="bi bi-collection me-2"></i>
                    Personal Collection
                </a>
            </li>
        </ul>
        <hr>
        
        <div class="dropdown">
            <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2">
                <strong>Johnny</strong>
            </a>
            <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
                <li><a class="dropdown-item" href="#">New Project...</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
                <li><a class="dropdown-item" href="#">Profile</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Sign out</a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-grow-1 p-4 bg-light">
        <div class="container-fluid">
            <!-- Search Box -->
            <div class="search-box">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search tables...">
                </div>
            </div>

            <!-- Table Cards -->
            <div class="row g-4" id="cardContainer"></div>
        </div>
    </div>
</main>

<!-- Table Modal -->
<div class="modal fade" id="tableModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Table View</h5>
                <div class="ms-auto me-2">
                    <div class="btn-group">
                        <!-- Filter Button -->
                        <button class="btn btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#filterSection">
                            <i class="bi bi-funnel"></i> Filter
                        </button>
                        <!-- Summarize Button -  -->
                        <button class="btn btn-outline-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#analysisModal">
                            <i class="bi bi-bar-chart"></i> Analyze Data
                        </button>
                        <!-- Import/Export Button -->
                        <div class="btn-group">
                            <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="bi bi-arrow-down-up"></i> Import/Export
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="bi bi-upload"></i> Import Data</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-download"></i> Export as CSV</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-download"></i> Export as Excel</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Filter Section -->
            <div class="collapse" id="filterSection">
                <div class="card card-body border-0">
                    <h6 class="mb-3">Filter Data</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <select class="form-select" id="filterColumn">
                                <option selected>Select Column...</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="filterOperator">
                                <option value="equals">Equals</option>
                                <option value="contains">Contains</option>
                                <option value="greater">Greater than</option>
                                <option value="less">Less than</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="filterValue" placeholder="Enter value...">
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-primary w-100" id="applyFilter">
                                <i class="bi bi-check-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-2" id="activeFilters">
                        <!-- Active filters will be shown here -->
                    </div>
                </div>
            </div>

            <div class="modal-body">
                <!-- 添加保存按钮和搜索框 -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <!-- 搜索框 -->
                    <div class="input-group" style="width: 300px;">
                        <span class="input-group-text">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="text" class="form-control" id="tableSearch" placeholder="Search in table...">
                    </div>
                    
                    <!-- 保存按钮 -->
                    <button class="btn btn-primary" id="saveTableBtn">
                        <i class="bi bi-save me-1"></i> Save Table
                    </button>
                </div>

                <!-- Table Container -->
                <div class="table-container">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <!-- Headers will be dynamically populated -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be dynamically populated -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div class="d-flex align-items-center">
                        <select class="form-select me-2" style="width: auto;" id="rowsPerPage">
                            <option value="10">10 rows</option>
                            <option value="25">25 rows</option>
                            <option value="50">50 rows</option>
                            <option value="100">100 rows</option>
                        </select>
                        <span class="text-muted" id="tableInfo">Showing 1-10 of 100 rows</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <nav class="me-3">
                            <ul class="pagination mb-0">
                                <li class="page-item">
                                    <a class="page-link" href="#" id="prevPage">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item d-none d-sm-block"><a class="page-link" href="#" data-page="1">1</a></li>
                                <li class="page-item d-none d-sm-block"><a class="page-link" href="#" data-page="2">2</a></li>
                                <li class="page-item d-none d-sm-block"><a class="page-link" href="#" data-page="3">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#" id="nextPage">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        <!-- 添加页面跳转输入框 -->
                        <div class="d-flex align-items-center">
                            <span class="me-2">Go to</span>
                            <input type="number" class="form-control" id="pageInput" style="width: 70px;" min="1">
                            <button class="btn btn-primary ms-2" id="goToPage">Go</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="analysisModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Data Analysis</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    
                    <div class="col-md-4 border-end">
                        <h6 class="mb-3">Analysis Configuration</h6>
                        <div class="mb-4">
                            <label class="form-label">Group By</label>
                            <select class="form-select mb-2" id="groupByColumn">
                                <option selected>Select column to group by...</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Metrics</label>
                            <div class="metric-item mb-2">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <select class="form-select" id="aggregateFunction">
                                            <option value="count">Count</option>
                                            <option value="sum">Sum</option>
                                            <option value="average">Average</option>
                                            <option value="min">Minimum</option>
                                            <option value="max">Maximum</option>
                                            <option value="distinct">Distinct Count</option>
                                        </select>
                                    </div>
                                    <div class="col-6">
                                        <select class="form-select" id="aggregateColumn">
                                            <option selected>Select column...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Visualization</label>
                            <select class="form-select mb-2" id="chartType">
                                <option value="bar">Bar Chart</option>
                                <option value="line">Line Chart</option>
                                <option value="pie">Pie Chart</option>
                                <option value="table">Table Only</option>
                            </select>
                        </div>

                        <button class="btn btn-primary w-100" id="applySummarize">
                            Apply Analysis
                        </button>
                    </div>

                    
                    <div class="col-md-8">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Analysis Results</h6>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary btn-sm" id="saveAnalysis">
                                    <i class="bi bi-save"></i> Save
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" id="exportAnalysis">
                                    <i class="bi bi-download"></i> Export
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" id="copyAnalysis">
                                    <i class="bi bi-clipboard"></i> Copy
                                </button>
                            </div>
                        </div>
                        
                        
                        <div id="chartContainer" style="height: 300px;" class="mb-3"></div>
                        
                        
                        <div class="table-responsive">
                            <table class="table table-sm" id="summaryTable">
                                <thead>
                                    <tr>
                                     
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 添加保存分析的模态框 -->
<div class="modal fade" id="saveAnalysisModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Save Analysis</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Analysis Name</label>
                    <input type="text" class="form-control" id="analysisName" placeholder="Enter a name for this analysis">
                </div>
                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="analysisDescription" rows="3" placeholder="Add a description (optional)"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Collection</label>
                    <select class="form-select" id="analysisCollection">
                        <option value="our-analytics">Our Analytics</option>
                        <option value="personal">Personal Collection</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmSaveAnalysis">Save Analysis</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加保存表格的模态框 -->
<div class="modal fade" id="saveTableModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Save Table</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Table Name</label>
                    <input type="text" class="form-control" id="tableName" placeholder="Enter a name for this table">
                </div>
                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="tableDescription" rows="3" placeholder="Add a description (optional)"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="tableCategory">
                        <option value="users">Users</option>
                        <option value="orders">Orders</option>
                        <option value="products">Products</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmSaveTable">Save</button>
            </div>
        </div>
    </div>
</div>

<script src="./assets/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const tableData = {
    users: {
        headers: ['ID', 'Name', 'Email', 'Role', 'Status', 'Created At', 'Last Login', 'Department', 'Location'],
        rows: [
            [1, 'John Doe', 'john@example.com', 'User', 'Active', '2023-01-01', '2024-03-10', 'Sales', 'New York'],
            [2, 'Jane Smith', 'jane@example.com', 'Admin', 'Active', '2023-01-02', '2024-03-11', 'IT', 'San Francisco'],
            [3, 'Bob Johnson', 'bob@example.com', 'User', 'Inactive', '2023-01-03', '2024-02-15', 'Marketing', 'Chicago'],
            [4, 'Alice Brown', 'alice@example.com', 'Manager', 'Active', '2023-02-01', '2024-03-12', 'HR', 'Boston'],
            [5, 'Charlie Wilson', 'charlie@example.com', 'User', 'Active', '2023-02-15', '2024-03-10', 'Sales', 'Miami'],
            [6, 'Diana Miller', 'diana@example.com', 'User', 'Active', '2023-03-01', '2024-03-11', 'Marketing', 'Seattle'],
            [7, 'Edward Davis', 'edward@example.com', 'Manager', 'Active', '2023-03-15', '2024-03-12', 'IT', 'Austin'],
            [8, 'Fiona Clark', 'fiona@example.com', 'User', 'Inactive', '2023-04-01', '2024-02-20', 'Sales', 'Denver'],
            [9, 'George White', 'george@example.com', 'Admin', 'Active', '2023-04-15', '2024-03-11', 'HR', 'Portland'],
            [10, 'Helen Young', 'helen@example.com', 'User', 'Active', '2023-05-01', '2024-03-12', 'Marketing', 'Dallas']
        ]
    },
    orders: {
        headers: ['Order ID', 'Customer', 'Product', 'Amount', 'Status', 'Date', 'Payment Method', 'Shipping', 'Notes'],
        rows: [
            ['ORD001', 'John Doe', 'Product A', '$100.00', 'Completed', '2024-03-01', 'Credit Card', 'Express', 'Priority delivery'],
            ['ORD002', 'Jane Smith', 'Product B', '$200.00', 'Pending', '2024-03-02', 'PayPal', 'Standard', ''],
            ['ORD003', 'Bob Johnson', 'Product C', '$150.00', 'Shipped', '2024-03-03', 'Credit Card', 'Express', ''],
            ['ORD004', 'Alice Brown', 'Product D', '$300.00', 'Processing', '2024-03-04', 'Bank Transfer', 'Standard', 'Gift wrap'],
            ['ORD005', 'Charlie Wilson', 'Product E', '$250.00', 'Completed', '2024-03-05', 'Credit Card', 'Express', ''],
            ['ORD006', 'Diana Miller', 'Product F', '$180.00', 'Shipped', '2024-03-06', 'PayPal', 'Standard', ''],
            ['ORD007', 'Edward Davis', 'Product G', '$420.00', 'Completed', '2024-03-07', 'Credit Card', 'Express', 'Fragile'],
            ['ORD008', 'Fiona Clark', 'Product H', '$90.00', 'Processing', '2024-03-08', 'Bank Transfer', 'Standard', ''],
            ['ORD009', 'George White', 'Product I', '$150.00', 'Pending', '2024-03-09', 'PayPal', 'Express', ''],
            ['ORD010', 'Helen Young', 'Product J', '$275.00', 'Shipped', '2024-03-10', 'Credit Card', 'Standard', 'Business order']
        ]
    },
    products: {
        headers: ['Product ID', 'Name', 'Category', 'Price', 'Stock', 'Status', 'Supplier', 'Last Updated', 'Rating'],
        rows: [
            ['PRD001', 'Premium Laptop', 'Electronics', '$1,299.99', '50', 'In Stock', 'TechCorp', '2024-03-01', '4.5'],
            ['PRD002', 'Wireless Mouse', 'Accessories', '$29.99', '200', 'In Stock', 'AccessTech', '2024-03-02', '4.2'],
            ['PRD003', 'Gaming Monitor', 'Electronics', '$499.99', '30', 'Low Stock', 'DisplayPro', '2024-03-03', '4.8'],
            ['PRD004', 'Mechanical Keyboard', 'Accessories', '$149.99', '0', 'Out of Stock', 'KeyTech', '2024-03-04', '4.6'],
            ['PRD005', 'USB-C Hub', 'Accessories', '$79.99', '150', 'In Stock', 'ConnectPro', '2024-03-05', '4.3'],
            ['PRD006', 'Wireless Earbuds', 'Audio', '$199.99', '25', 'Low Stock', 'SoundTech', '2024-03-06', '4.7'],
            ['PRD007', 'Desktop PC', 'Electronics', '$1,499.99', '15', 'In Stock', 'TechCorp', '2024-03-07', '4.4'],
            ['PRD008', 'Webcam HD', 'Accessories', '$89.99', '0', 'Out of Stock', 'ViewTech', '2024-03-08', '4.1'],
            ['PRD009', 'Gaming Headset', 'Audio', '$129.99', '45', 'In Stock', 'SoundTech', '2024-03-09', '4.9'],
            ['PRD010', 'Tablet Pro', 'Electronics', '$899.99', '20', 'Low Stock', 'TechCorp', '2024-03-10', '4.6']
        ]
    }
};

// Modal event handler
document.getElementById('tableModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const tableType = button.getAttribute('data-table');
    const modalTitle = this.querySelector('.modal-title');
    const tableHead = this.querySelector('thead tr');
    const tableBody = this.querySelector('tbody');
    
    // Update modal title
    modalTitle.textContent = `${tableType.charAt(0).toUpperCase() + tableType.slice(1)} Table`;
    
    // Clear existing table content
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';
    
    // Populate headers
    tableData[tableType].headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        tableHead.appendChild(th);
    });
    
    // Populate rows
    tableData[tableType].rows.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
        });
        tableBody.appendChild(tr);
    });

    // 分页状态
    let currentPage = 1;
    let rowsPerPage = 10;
    let totalRows = 0;
    let totalPages = 0;
    let currentTableType = '';

    // 更新分页信息
    function updatePagination(tableType) {
        totalRows = tableData[tableType].rows.length;
        totalPages = Math.ceil(totalRows / rowsPerPage);
        
        // 更新表格信息显示
        const start = (currentPage - 1) * rowsPerPage + 1;
        const end = Math.min(currentPage * rowsPerPage, totalRows);
        document.getElementById('tableInfo').textContent = 
            `Showing ${start}-${end} of ${totalRows} rows`;

        // 更新分页按钮
        const pagination = document.querySelector('.pagination');
        const pageItems = pagination.querySelectorAll('.page-item:not(:first-child):not(:last-child)');
        
        pageItems.forEach((item, index) => {
            const pageNum = currentPage - 1 + index;
            if (pageNum > 0 && pageNum <= totalPages) {
                item.classList.remove('d-none');
                item.classList.remove('active');
                if (pageNum === currentPage) {
                    item.classList.add('active');
                }
                item.querySelector('.page-link').textContent = pageNum;
                item.querySelector('.page-link').dataset.page = pageNum;
            } else {
                item.classList.add('d-none');
            }
        });

        // 更新上一页/下一页按钮状态
        document.getElementById('prevPage').parentElement.classList.toggle('disabled', currentPage === 1);
        document.getElementById('nextPage').parentElement.classList.toggle('disabled', currentPage === totalPages);

        // 显示对应页面的数据
        displayTableData(tableType);
    }

    // 显示表格数据
    function displayTableData(tableType) {
        const tbody = document.querySelector('#tableModal tbody');
        tbody.innerHTML = '';
        
        const start = (currentPage - 1) * rowsPerPage;
        const end = Math.min(start + rowsPerPage, tableData[tableType].rows.length);
        
        for (let i = start; i < end; i++) {
            const row = tableData[tableType].rows[i];
            const tr = document.createElement('tr');
            row.forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        }
    }

    // 修改模态框显示事件处理程序
    document.getElementById('tableModal').addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        const tableType = button.getAttribute('data-table');
        currentTableType = tableType;
        currentPage = 1;
        
        // ... 保持现有的模态框显示代码 ...
        
        // 更新分页
        updatePagination(tableType);
    });

    // 每页行数变化处理
    document.getElementById('rowsPerPage').addEventListener('change', function(e) {
        rowsPerPage = parseInt(e.target.value);
        currentPage = 1;
        updatePagination(currentTableType);
    });

    // 页码点击处理
    document.querySelector('.pagination').addEventListener('click', function(e) {
        e.preventDefault();
        if (e.target.classList.contains('page-link')) {
            const page = e.target.dataset.page;
            if (page) {
                currentPage = parseInt(page);
                updatePagination(currentTableType);
            } else if (e.target.id === 'prevPage' && currentPage > 1) {
                currentPage--;
                updatePagination(currentTableType);
            } else if (e.target.id === 'nextPage' && currentPage < totalPages) {
                currentPage++;
                updatePagination(currentTableType);
            }
        }
    });

    // 页面跳转处理
    document.getElementById('goToPage').addEventListener('click', function() {
        const pageInput = document.getElementById('pageInput');
        const pageNum = parseInt(pageInput.value);
        
        if (pageNum && pageNum > 0 && pageNum <= totalPages) {
            currentPage = pageNum;
            updatePagination(currentTableType);
            pageInput.value = ''; // 清空输入框
        } else {
            // 显示错误提示
            alert(`Please enter a valid page number between 1 and ${totalPages}`);
            pageInput.value = '';
        }
    });

    // 回车键跳转页面
    document.getElementById('pageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('goToPage').click();
        }
    });
});

// Add event listeners for new functionality
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    document.getElementById('tableSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const tbody = document.querySelector('#tableModal tbody');
        Array.from(tbody.getElementsByTagName('tr')).forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    // Filter functionality
    document.getElementById('applyFilter').addEventListener('click', function() {
        const column = document.getElementById('filterColumn').value;
        const operator = document.getElementById('filterOperator').value;
        const value = document.getElementById('filterValue').value;
        
        // Add filter tag
        const filterTag = document.createElement('span');
        filterTag.className = 'badge bg-primary me-2 mb-2';
        filterTag.innerHTML = `${column} ${operator} ${value} <i class="bi bi-x-circle ms-1" style="cursor: pointer;"></i>`;
        document.getElementById('activeFilters').appendChild(filterTag);
        
        // Add remove filter functionality
        filterTag.querySelector('i').addEventListener('click', function() {
            filterTag.remove();
            // Reset filter
        });
    });

    // Populate filter and summarize dropdowns when modal opens
    document.getElementById('tableModal').addEventListener('show.bs.modal', function(event) {
        const tableType = event.relatedTarget.getAttribute('data-table');
        const headers = tableData[tableType].headers;
        
        // Populate filter column dropdown
        const filterColumn = document.getElementById('filterColumn');
        filterColumn.innerHTML = '<option selected>Select Column...</option>' + 
            headers.map(header => `<option value="${header}">${header}</option>`).join('');
        
        // Populate group by and aggregate column dropdowns
        const groupByColumn = document.getElementById('groupByColumn');
        const aggregateColumn = document.getElementById('aggregateColumn');
        groupByColumn.innerHTML = '<option selected>Group by...</option>' + 
            headers.map(header => `<option value="${header}">${header}</option>`).join('');
        aggregateColumn.innerHTML = '<option selected>Select Column...</option>' + 
            headers.map(header => `<option value="${header}">${header}</option>`).join('');
    });

    // Update Users card stats
    document.querySelector('[data-table="users"] .table-stats').innerHTML = `
        <span class="badge bg-light text-dark me-2">
            <i class="bi bi-table me-1"></i> ${tableData.users.rows.length} rows
        </span>
        <span class="badge bg-light text-dark">
            <i class="bi bi-columns me-1"></i> ${tableData.users.headers.length} columns
        </span>
    `;

    // Update Orders card stats
    document.querySelector('[data-table="orders"] .table-stats').innerHTML = `
        <span class="badge bg-light text-dark me-2">
            <i class="bi bi-table me-1"></i> ${tableData.orders.rows.length} rows
        </span>
        <span class="badge bg-light text-dark">
            <i class="bi bi-columns me-1"></i> ${tableData.orders.headers.length} columns
        </span>
    `;

    // Update Products card stats
    document.querySelector('[data-table="products"] .table-stats').innerHTML = `
        <span class="badge bg-light text-dark me-2">
            <i class="bi bi-table me-1"></i> ${tableData.products.rows.length} rows
        </span>
        <span class="badge bg-light text-dark">
            <i class="bi bi-columns me-1"></i> ${tableData.products.headers.length} columns
        </span>
    `;

    // 数据分析相关功能
    let currentChart = null;

    // 应用分析按钮点击事件
    document.getElementById('applySummarize').addEventListener('click', function() {
        const groupByColumn = document.getElementById('groupByColumn').value;
        const aggregateFunction = document.getElementById('aggregateFunction').value;
        const aggregateColumn = document.getElementById('aggregateColumn').value;
        const chartType = document.getElementById('chartType').value;

        // 执行数据分析
        const results = analyzeData(currentTableType, groupByColumn, aggregateFunction, aggregateColumn);
        
        // 更新结果表格
        updateSummaryTable(results);
        
        // 更新图表
        updateChart(results, chartType);
    });

    // 数据分析函数
    function analyzeData(tableType, groupBy, aggFunction, aggColumn) {
        const data = tableData[tableType].rows;
        const groupByIndex = tableData[tableType].headers.indexOf(groupBy);
        const aggColumnIndex = tableData[tableType].headers.indexOf(aggColumn);

        // 分组数据
        const grouped = {};
        data.forEach(row => {
            const groupKey = row[groupByIndex];
            if (!grouped[groupKey]) {
                grouped[groupKey] = [];
            }
            grouped[groupKey].push(row[aggColumnIndex]);
        });

        // 计算聚合结果
        const results = [];
        for (let key in grouped) {
            let value;
            switch(aggFunction) {
                case 'count':
                    value = grouped[key].length;
                    break;
                case 'sum':
                    value = grouped[key].reduce((a, b) => a + parseFloat(b), 0);
                    break;
                case 'average':
                    value = grouped[key].reduce((a, b) => a + parseFloat(b), 0) / grouped[key].length;
                    break;
                case 'min':
                    value = Math.min(...grouped[key].map(v => parseFloat(v)));
                    break;
                case 'max':
                    value = Math.max(...grouped[key].map(v => parseFloat(v)));
                    break;
                case 'distinct':
                    value = new Set(grouped[key]).size;
                    break;
            }
            results.push({
                group: key,
                value: value
            });
        }

        return results;
    }

    // 更新结果表格
    function updateSummaryTable(results) {
        const table = document.getElementById('summaryTable');
        const thead = table.querySelector('thead');
        const tbody = table.querySelector('tbody');

        // 更新表头
        thead.innerHTML = `
            <tr>
                <th>Group</th>
                <th>Value</th>
            </tr>
        `;

        // 更新数据行
        tbody.innerHTML = results.map(row => `
            <tr>
                <td>${row.group}</td>
                <td>${typeof row.value === 'number' ? row.value.toFixed(2) : row.value}</td>
            </tr>
        `).join('');
    }

    // 更新图表
    function updateChart(results, chartType) {
        const ctx = document.getElementById('chartContainer');
        
        // 销毁现有图表
        if (currentChart) {
            currentChart.destroy();
        }

        // 准备图表数据
        const labels = results.map(r => r.group);
        const values = results.map(r => r.value);

        // 创建新图表
        currentChart = new Chart(ctx, {
            type: chartType === 'table' ? 'bar' : chartType,
            data: {
                labels: labels,
                datasets: [{
                    label: 'Analysis Result',
                    data: values,
                    backgroundColor: 'rgba(99, 102, 241, 0.5)',
                    borderColor: 'rgb(99, 102, 241)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // 如果选择了表格视图，隐藏图表
        document.getElementById('chartContainer').style.display = 
            chartType === 'table' ? 'none' : 'block';
    }

    // 导出分析结果
    document.getElementById('exportAnalysis').addEventListener('click', function() {
        const table = document.getElementById('summaryTable');
        const csv = [];
        
        // 获取表头
        const headers = [];
        table.querySelectorAll('thead th').forEach(th => {
            headers.push(th.textContent);
        });
        csv.push(headers.join(','));

        // 获取数据行
        table.querySelectorAll('tbody tr').forEach(tr => {
            const row = [];
            tr.querySelectorAll('td').forEach(td => {
                row.push(td.textContent);
            });
            csv.push(row.join(','));
        });

        // 创建下载链接
        const csvContent = "data:text/csv;charset=utf-8," + csv.join('\n');
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "analysis_results.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    });

    // 复制分析结果
    document.getElementById('copyAnalysis').addEventListener('click', function() {
        const table = document.getElementById('summaryTable');
        const range = document.createRange();
        range.selectNode(table);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        
        // 显示提示
        alert('Results copied to clipboard!');
    });

    // 保存分析按钮点击处理
    document.getElementById('saveAnalysis').addEventListener('click', function() {
        // 显示保存对话框
        const saveModal = new bootstrap.Modal(document.getElementById('saveAnalysisModal'));
        saveModal.show();
    });

    // 确认保存分析
    document.getElementById('confirmSaveAnalysis').addEventListener('click', function() {
        const analysisData = {
            name: document.getElementById('analysisName').value,
            description: document.getElementById('analysisDescription').value,
            collection: document.getElementById('analysisCollection').value,
            chartType: document.getElementById('chartType').value,
            groupBy: document.getElementById('groupByColumn').value,
            aggregateFunction: document.getElementById('aggregateFunction').value,
            aggregateColumn: document.getElementById('aggregateColumn').value,
            // 可以添加更多需要保存的数据...
            timestamp: new Date().toISOString(),
            createdBy: 'Johnny' // 当前用户
        };

        // 这里可以添加保存到后端的逻辑
        console.log('Saving analysis:', analysisData);
        
        // 关闭保存对话框
        bootstrap.Modal.getInstance(document.getElementById('saveAnalysisModal')).hide();
        
        // 显示成功提示
        alert('Analysis saved successfully!');
    });

    // 保存表格按钮点击处理
    document.getElementById('saveTableBtn').addEventListener('click', function() {
        // 显示保存表格对话框
        const saveModal = new bootstrap.Modal(document.getElementById('saveTableModal'));
        saveModal.show();
    });

    // 确认保存表格
    document.getElementById('confirmSaveTable').addEventListener('click', function() {
        const tableData = {
            name: document.getElementById('tableName').value,
            description: document.getElementById('tableDescription').value,
            category: document.getElementById('tableCategory').value,
            timestamp: new Date().toISOString(),
            createdBy: 'Johnny', // 当前用户
            // 可以添加更多需要保存的数据...
        };

        // 这里可以添加保存到后端的逻辑
        console.log('Saving table:', tableData);
        
        // 关闭保存对话框
        bootstrap.Modal.getInstance(document.getElementById('saveTableModal')).hide();
        
        // 显示成功提示
        alert('Table saved successfully!');
    });
});

// 卡片数据
const cards = [
    { table: 'users', icon: 'bi-people', title: 'Users', text: 'User profiles and account information', rows: 1000, columns: 8 },
    { table: 'orders', icon: 'bi-cart-check', title: 'Orders', text: 'Customer orders and transaction data', rows: 5000, columns: 10 },
    { table: 'products', icon: 'bi-box-seam', title: 'Products', text: 'Product catalog and inventory data', rows: 500, columns: 12 }
];

// 获取卡片容器
const cardContainer = document.getElementById('cardContainer');

// 循环输出卡片
cards.forEach(card => {
    const cardHTML = `
        <div class="col-md-4">
            <div class="card table-card" data-bs-toggle="modal" data-bs-target="#tableModal" data-table="${card.table}">
                <div class="card-body text-center">
                    <i class="bi ${card.icon} card-icon"></i>
                    <h5 class="card-title">${card.title}</h5>
                    <p class="card-text">${card.text}</p>
                    <div class="table-stats mt-3">
                        <span class="badge bg-light text-dark me-2">
                            <i class="bi bi-table me-1"></i> ${card.rows} rows
                        </span>
                        <span class="badge bg-light text-dark">
                            <i class="bi bi-columns me-1"></i> ${card.columns} columns
                        </span>
                    </div>
                </div>
            </div>
        </div>
    `;
    cardContainer.innerHTML += cardHTML; // 将卡片HTML添加到容器中
});
</script>

<!-- Don't forget to add the SVG definitions at the top of the body -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="bootstrap" viewBox="0 0 118 94">
        <title>Bootstrap</title>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M24.509 0c-6.733 0-11.715 5.893-11.492 12.284.214 6.14-.064 14.092-2.066 20.577C8.943 39.365 5.547 43.485 0 44.014v5.972c5.547.529 8.943 4.649 10.951 11.153 2.002 6.485 2.28 14.437 2.066 20.577C12.794 88.106 17.776 94 24.51 94H93.5c6.733 0 11.714-5.893 11.491-12.284-.214-6.14.064-14.092 2.066-20.577 2.009-6.504 5.396-10.624 10.943-11.153v-5.972c-5.547-.529-8.934-4.649-10.943-11.153-2.002-6.484-2.28-14.437-2.066-20.577C105.214 5.894 100.233 0 93.5 0H24.508zM80 57.863C80 66.663 73.436 72 62.543 72H44a2 2 0 01-2-2V24a2 2 0 012-2h18.437c9.083 0 15.044 4.92 15.044 12.474 0 5.302-4.01 10.049-9.119 10.88v.277C75.317 46.394 80 51.21 80 57.863zM60.521 28.34H49.948v14.934h8.905c6.884 0 10.68-2.772 10.68-7.727 0-4.643-3.264-7.207-9.012-7.207zM49.948 49.2v16.458H60.91c7.167 0 10.964-2.876 10.964-8.281 0-5.406-3.903-8.178-11.425-8.178H49.948z"></path>
    </symbol>
</svg>

</body>
</html> 